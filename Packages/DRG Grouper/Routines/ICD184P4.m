ICD184P4 ;BPOIFO/ESW - ICD/AGE,SEX; 9/26/02 4:26pm ; 10/22/02 3:37pm
 ;;18.0;DRG Grouper;**4**;Oct 13,2000
 ;
 ;This program will update two fields:
 ;     SEX (#9.5) - old description: USE ONLY WITH SEX
 ;     AGE (#15)  - a new field
 D BMES^XPDUTL(">>>>Upgrading AGE and SEX fields in Diagnosis file")
 N II,DIE,DA,DR,IC,ICD,ICD1,ICDR,ICDRS
 F II=1:1 S ICDRS=$P($T(RANGES+II),";;",2) Q:ICDRS="QUIT"  D
 .N PP
 .F PP=1:1:3 S ICDR=$P(ICDRS,"|",PP) Q:ICDR=""  D
 ..N RN1,RN2,R14,R15,IT
 ..S RN1=$P(ICDR,","),RN2=$P(ICDR,",",2),R14=$P(ICDR,",",3),R15=$P(ICDR,",",4),IT=$P(ICDR,",",5),IN=$L($P(IT,".",2))
 ..F ICD=RN1:IT:RN2 S ICD1=$J(ICD,0,IN)_" " S:$E(RN1)=0 ICD1=0_ICD1 S IC="" D
 ...I ICD1#1=0&(ICD1'[".") S ICD1=$E(ICD1,1,$L(ICD1)-1)_". "
 ...S IC=$O(^ICD9("AB",ICD1,IC)) I IC D  Q
 ....S DIE="^ICD9(",DA=IC,DR="9.5////^S X=R14;15////^S X=R15;"
 ....L +^ICD9(DA):0 I $T D ^DIE L -^ICD9(DA) Q
 ...;I 'IC D BMES^XPDUTL(">>> Missing diagnosis "_ICD1_"not updated ")
 G LOOKV
 Q
 ;
LOOKV ;;
 N II,DIE,DA,DR,IC,ICD,ICD1,ICDR,ICDRS
 F II=1:1 S ICDRS=$P($T(VCODE+II),";;",2) Q:ICDRS="QUIT"  D
 .N PP
 .F PP=1:1:3 S ICDR=$P(ICDRS,"|",PP) Q:ICDR=""  D
 ..N RN1,RN2,R14,R15,IT
 ..S RN1=$P(ICDR,","),RN2=$P(ICDR,",",2),R14=$P(ICDR,",",3),R15=$P(ICDR,",",4),IT=$P(ICDR,",",5),IN=$L($P(IT,".",2))
 ..F ICD=RN1:IT:RN2 S ICD1=$J(ICD,0,IN)_" " S:$E(RN1)=0 ICD1=0_ICD1 S ICD1="V"_ICD1 S IC="" D
 ...I ICD1#1=0&(ICD1'[".") S ICD1=$E(ICD1,1,$L(ICD1)-1)_". "
 ...S IC=$O(^ICD9("AB",ICD1,IC)) I IC D  Q
 ....S DIE="^ICD9(",DA=IC,DR="9.5////^S X=R14;15////^S X=R15;"
 ....L +^ICD9(DA):0 I $T D ^DIE L -^ICD9(DA) Q
 ...;I 'IC D BMES^XPDUTL(">>> Missing diagnosis "_ICD1_"not updated ")
 G OTHER
 Q
OTHER ;
 N LABEL
 F LABEL="SEXM","SEXF","AGEP","AGEN","AGEA","SEXMAGEA","SEXFAGEA" D WORK(LABEL)
 Q
WORK(LAB) ;
 N R14,R15,II,RR
 S RR=$P($T(@LAB),";;",2),R14=$P(RR,","),R15=$P(RR,",",2)
 F II=1:1 S ICDRS=$P($T(@LAB+II),";;",2) Q:ICDRS="QUIT"  D
 .N PP
 .F PP=1:1:10 S ICD=$P(ICDRS,",",PP) Q:ICD=""  D
 ..N IN
 ..S IN=$L($P(ICD,".",2)),ICD1=ICD
 ..S:$E(ICD)'="V" ICD1=$J(ICD,0,IN) S:$E(ICD)=0 ICD1=0_ICD1 S ICD1=ICD1_" " S IC="" D
 ...I ICD1#1=0&(ICD1'[".") S ICD1=$E(ICD1,1,$L(ICD1)-1)_". "
 ...S IC=$O(^ICD9("AB",ICD1,IC)) I IC D  Q
 ....S DIE="^ICD9(",DA=IC,DR="9.5////^S X=R14;15////^S X=R15;"
 ....L +^ICD9(DA):0 I $T D ^DIE L -^ICD9(DA) Q
 ...;I 'IC D BMES^XPDUTL(">>> Missing diagnosis "_ICD1_"not updated ")
 Q
RANGES ;;
 ;;016.40,016.46,M,,0.01|016.50,016.56,M,,0.01|016.60,016.66,F,,0.01
 ;;016.70,016.76,F,,0.01|054.11,054.12,F,,0.01|098.12,098.14,M,,0.01
 ;;098.15,098.17,F,,0.01|098.32,098.34,M,,0.01|098.35,098.37,F,,0.01
 ;;174.0,174.6,F,,0.1|174.8,174.9,F,,0.1|184.0,184.4,F,,.1
 ;;184.8,184.9,F,,.1|187.1,187.9,M,,.1|179,184,F,,1.
 ;;183.8,183.9,F,,.1|183.2,183.5,F,,.1|185,187,M,,1.
 ;;218.0,218.2,F,,.1|218.9,219.1,F,,.1|219,221,F,,1.
 ;;219.8,219.9,F,,.1|221.0,221.2,F,,.1|221.8,221.9,F,,.1
 ;;222.0,222.4,M,,.1|222.8,222.9,M,,.1|233.1,233.3,F,,.1
 ;;233.4,233.6,M,,.1|236.0,236.3,F,,.1|236.4,236.6,M,,.1
 ;;256.0,256.4,F,,.1|256.8,256.9,F,,.1|257.0,257.2,M,,.1
 ;;257.8,257.9,M,,.1|302.74,302.75,M,,.01|306.51,306.52,F,,.1
 ;;600.0,601.0,M,,1.0|600.1,600.2,M,A,.1|601.1,601.4,M,,.1
 ;;602.0,602.2,M,A,.1|602.8,602.9,M,A,.1|604.90,604.91,M,,.01
 ;;606.8,607.3,M,,.1|607.81,607.83,M,,.01|607.9,608.4,M,,.1
 ;;608.83,608.86,M,,.01|614.0,615.1,F,,.1|615.9,616.5,F,,.1
 ;;616.50,616.51,F,,.01|616.8,617.6,F,,.1|617.8,619.2,F,,.1
 ;;619.8,619.9,F,,.1|620.0,624.6,F,,.1|624.8,624.9,F,,.1
 ;;625.0,625.6,F,,.1|625.8,625.9,F,,.1|626.0,627.4,F,,.1
 ;;627.8,627.9,F,,.1|628.0,628.4,F,,.1|628.8,628.9,F,,.1
 ;;629.0,629.1,F,,.1|629.8,629.9,F,,.1|630,632,F,A,1.
 ;;634.0,637.0,F,,1.0|633,648,F,,1.|633.0,633.2,F,A,.1
 ;;633.8,633.9,F,A,.1|634.00,637.90,F,A,.10|634.01,637.91,F,A,.10
 ;;634.02,637.92,F,A,.10|634.1,637.9,F,,.1|638.0,639.6,F,A,.1
 ;;639.8,639.9,F,A,.1|640.0,644.0,F,,1.0|640.00,644.00,F,A,1.00
 ;;640.01,643.01,F,A,1.00|641.9,642.7,F,,.1|642.04,642.74,F,A,.10
 ;;641.80,642.70,F,A,.10|641.81,642.71,F,A,.10|641.83,642.73,F,A,.10
 ;;642.02,642.72,F,A,.10|642.9,643.2,F,,.1|642.90,643.20,F,A,.10
 ;;642.91,643.21,F,A,.10|642.92,642.94,F,A,.01|643.13,643.23,F,A,.10
 ;;643.8,644.2,F,,.1|643.80,644.20,F,A,.10|643.81,643.91,F,A,.10
 ;;643.83,644.13,F,A,.10|646.0,647.6,F,,.1|646.00,648.90,F,A,.10
 ;;646.01,647.61,F,A,.10|646.03,647.63,F,A,.10|645.21,645.21,F,A,.01
 ;;645.1,645.2,F,,.1|646.12,646.22,F,A,.10|646.14,646.24,F,A,.1
 ;;646.42,646.62,F,A,.10|646.44,646.64,F,A,.10|647.02,647.62,F,A,.10
 ;;647.04,647.64,F,A,.10|648.0,648.9,F,,.1|648.01,648.91,F,A,.10
 ;;648.02,648.92,F,A,.10|648.03,648.93,F,A,.10|648.04,F,A,.10
 ;;647.8,647.9,F,,.1|647.81,647.84,F,A,.01|647.91,647.94,F,A,.01
 ;;651.1,651.6,F,,.1|651.00,651.60,F,A,.10|651.01,651.61,F,A,.10
 ;;651.03,651.63,F,A,.10|652.0,653.7,F,,.1|652.00,657.00,F,A,.10
 ;;652.01,657.01,F,A,.10|652.03,657.03,F,A,.10|654.1,655.2,F,,.1
 ;;654.32,654.92,F,A,.10|654.34,654.94,F,A,.10|658.00,658.40,F,A,.10
 ;;658.80,661.40,F,A,.10|658.01,658.41,F,A,.10|658.81,661.41,F,A,.10
 ;;658.03,658.43,F,A,.10|658.83,661.43,F,A,.10|661.90,662.30,F,A,.10
 ;;661.91,662.31,F,A,.10|661.93,662.33,F,A,.10|663.00,663.60,F,A,.10
 ;;663.01,663.61,F,A,.10|663.03,663.63,F,A,.10|663.80,664.50,F,A,.10
 ;;663.81,664.51,F,A,.10|663.83,663.93,F,A,.10|664.04,664.54,F,A,.10
 ;;664.80,666.30,F,A,.10|664.81,665.11,F,A,.10|665.24,665.74,F,A,.10
 ;;665.31,665.91,F,A,.10|665.72,666.32,F,A,.10|665.83,665.93,F,A,.10
 ;;665.84,666.34,F,A,.10|667.00,676.00,F,A,1.00|667.02,676.02,F,A,1.00
 ;;667.04,676.04,F,A,1.00|667.10,669.10,F,A,1.00|667.12,669.12,F,A,1.00
 ;;667.14,669.14,F,A,1.00|668.20,668.24,F,A,.01|668.80,668.84,F,A,.01
 ;;668.90,668.94,F,A,.01|668.01,669.01,F,A,1.00|668.03,669.03,F,A,1.00
 ;;668.11,669.11,F,A,1.00|668.13,669.13,F,A,1.00|669.20,669.90,F,A,.10
 ;;669.21,669.24,F,A,.01|669.41,669.44,F,A,.01|669.51,669.01,F,A,.10
 ;;669.82,669.84,F,A,.01|669.92,669.94,F,A,.01|671.10,671.14,F,A,.01
 ;;671.20,671.24,F,A,.01|716.32,716.39,F,,.01|016.6,016.7,F,,0.1
 ;;180.0,180.1,F,,.1|180.8,180.9,F,,.1|671.30,671.50,F,A,.10
 ;;671.51,671.54,F,A,.01|671.80,671.84,F,A,.01|671.90,671.94,F,A,.01
 ;;673.10,673.14,F,A,.01|673.20,673.24,F,A,.01|673.30,673.34,F,A,.01
 ;;673.80,673.84,F,A,.01|674.01,674.04,F,A,.01|674.10,674.40,F,A,.10|
 ;;674.12,674.42,F,A,.10|674.14,674.44,F,A,.10|674.80,675.20,F,A,.10
 ;;674.84,675.24,F,A,.10|675.01,675.21,F,A,.10|675.03,675.23,F,A,.10
 ;;675.80,675.84,F,A,.01|675.90,675.94,F,A,.01|676.00,676.04,F,A,.01
 ;;676.10,676.14,F,A,.01|676.20,676.24,F,A,.01|676.30,676.34,F,A,.01
 ;;676.40,676.44,F,A,.01|676.50,676.54,F,A,.01|676.60,676.64,F,A,.01
 ;;676.80,676.84,F,A,.01|676.90,676.94,F,A,.01|764.01,764.29,,N,.01
 ;;762.0,763.7,,N,.1|763.81,763.83,,N,.01|752.51,752.52,M,,.01
 ;;752.61,752.62,M,,.01|752.63,752.65,M,,.01|764.90,765.19,,N,.01
 ;;766.0,766.2,,N,.1|767.0,768.6,,N,.1|770.0,771.8,,N,.1
 ;;772.0,772.6,,N,.1|772.8,773.4,,N,.1|774.0,776.0,,N,1.0|
 ;;775.4,776.9,,N,.1|775.1,775.3,,N,.1|774.4,774.7,,N,.1|
 ;;774.1,774.2,,N,.1|774.30,774.31,,N,.1|777.1,777.6,,N,.1|
 ;;777.8,779.6,,N,.1|779.8,779.9,,N,.1|878.0,878.3,M,,.1|
 ;;878.4,878.7,F,,.1|867.4,867.5,F,,.1|995.50,995.55,,P,.01|
 ;;902.55,902.56,F,,.01|902.81,902.82,F,,.01|939.1,939.2,F,,.1|
 ;;995.80,995.83,,A,.01|645.23,645.23,F,A,.01
 ;;QUIT
VCODE ;;
 ;;10.40,10.44,F,,.01|10.45,10.49,M,,.01|20.0,20.2,,P,.1
 ;;23.0,23.5,F,A,.1|23.81,23.84,F,A,.01|27.0,27.7,F,A,.1
 ;;22.0,22.2,F,,.1|25.41,25.43,F,,.01|24.1,26.1,F,,1.0
 ;;27.9,28.2,F,A,.1|29.0,29.3,,N,.1|30.0,37.0,,N,1.0
 ;;30.00,37.00,,N,1.00|30.01,37.01,,N,1.00|30.1,37.1,,N,1.0
 ;;23.7,23.8,F,A,.1|
 ;;QUIT
SEXM ;;M,
 ;;016.5,054.13,072.0,131.03,175.0,175.9,186.0,186.9,214.4,222
 ;;257,456.4,600.3,600.9,601.9,604.0,604.99,605,606.0,607.89
 ;;608.81,608.89,608.9,752.69,758.7,788.32,790.93,792.2,939.3,V13.61
 ;;V26.52,V50.2,V76.44,V76.45
 ;;QUIT
SEXF ;;F,
 ;;112.1,131.01,182.0,182.1,182.8,183.0,198.6,256.31,256.39,302.76
 ;;456.6,615,616,616.10,616.11,617,619,620,621,622
 ;;623,624,625,626,627,628,629,651,651.8,651.9
 ;;652,653,653.9,654,655,716.30,752.0,752.10,752.11,752.19
 ;;752.2,752.3,752.40,652.41,752.42,752.49,795.0,947.4,996.32,V07.4
 ;;V13.1,V22,V23,V24.2,V25.01,V25.3,V25.5,V26.51,V45.51,V49.81
 ;;V50.42,V52.4,V67.01,V72.3,V72.4,V76.11,V76.2,V76.47,V82.4
 ;;795.00,795.01,795.02,795.09,V13.21,V13.29,V23.41,V23.49
 ;;QUIT
AGEP ;;,P
 ;;259.1,331.81,751.1,751.2,751.61,995.59,690.11,690.12,798.0
 ;;QUIT
AGEN ;;,N
 ;;277.01,763.89,763.9,764.00,768.9,769,774.39,V39,V39.00,V39.01
 ;;V39.1
 ;;QUIT
AGEA ;;,A
 ;;366.17,500,995.85,V71.01
 ;;QUIT
SEXMAGEA ;;M,A
 ;;601.8,606.1,607.84
 ;;QUIT
SEXFAGEA ;;F,A
 ;;644.21,645.10,645.11,645.13,646.82,646.84,650,651.0,651.80,651.81
 ;;651.83,651.90,651.91,651.93,653.8,654.0,654.02,654.04,654.12,654.14
 ;;664.84,665.03,665.22,669.32,669.34,671.01,671.03,673.01,673.03,671.42
 ;;671.31,671.33,671.44,677,716.31,792.3,796.5,V23.89,V23.9,V24
 ;;V24.0,V28.6,V61.6,V61.7
 ;;QUIT
 ;;
