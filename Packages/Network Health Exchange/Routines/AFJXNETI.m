AFJXNETI ;FJ/CWS;7/20/94; UPDATE NETWORK IDENTIFIER
 ;;4.3;NHEX
PROCESS ; Process incoming message
 S DUZ=.5,DUZ(0)="@",U="^",(FLO,FLAG,CT)=0,U="^" D NOW^%DTC S TBG=%
 D START,BULLET,SEND
 Q
START S SSN="" F  S SSN=$O(^AFJ(537010,"B",SSN)),INT="" Q:SSN=""  F  S INT=$O(^AFJ(537010,"B",SSN,INT)) Q:INT=""  S AAT=0 D WHERE,CHECK
 Q
CHECK S IFN="" F  S IFN=$O(^DPT("ASSN",SSN,IFN)) Q:IFN=""  D ADD
 Q
ADD Q:IFN=""  S NWI=$P($G(^DPT(IFN,537025)),U)
 Q:FROM=NWI
 S $P(^DPT(IFN,537025),U)=FROM,FLO=FLO+1
 Q
WHERE S (PLAC,PLAC1,PLAC2,PLAC3)=""
 S:$D(^AFJ(537010,INT,1,1,0)) PLAC=$P(^AFJ(537010,INT,1,1,0),U,1),PLAC=$S(PLAC=1:"L",PLAC=2:"W",PLAC=3:"N",PLAC=4:"H",PLAC>4:"",PLAC="":"")
 S:$D(^AFJ(537010,INT,1,2,0)) PLAC1=$P(^AFJ(537010,INT,1,2,0),U,1),PLAC1=$S(PLAC1=1:"L",PLAC1=2:"W",PLAC1=3:"N",PLAC1=4:"H",PLAC1>4:"",PLAC1="":"")
 S:$D(^AFJ(537010,INT,1,3,0)) PLAC2=$P(^AFJ(537010,INT,1,3,0),U,1),PLAC2=$S(PLAC2=1:"L",PLAC2=2:"W",PLAC2=3:"N",PLAC2=4:"H",PLAC2>4:"",PLAC2="":"")
 S:$D(^AFJ(537010,INT,1,4,0)) PLAC3=$P(^AFJ(537010,INT,1,4,0),U,1),PLAC3=$S(PLAC3=1:"L",PLAC3=2:"W",PLAC3=3:"N",PLAC3=4:"H",PLAC3>4:"",PLAC3="":"")
 S FROM=PLAC_PLAC1_PLAC2_PLAC3
 Q
BULLET D NOW^%DTC S TEN=%
 S CT=CT+1,^TMP("NIU",$J,CT,0)="          ",CT=CT+1,^TMP("NIU",$J,CT,0)="TIME BEGAN: "_TBG
 S CT=CT+1,^TMP("NIU",$J,CT,0)="TIME ENDED: "_TEN
 S CT=CT+1,^TMP("NIU",$J,CT,0)="TOTAL # PATIENTS UPDATED   "_FLO
 Q
SEND ; SEND MESS
 S XMTEXT="^TMP(""NIU"",$J,"
 S XMSUB="NETWORK PATIENT IDENTIFIER UPDATE"
 D ^XMD K ^TMP("NIU",$J),FLO,XMSUB,XMTEXT,XMY
 Q
 ;
