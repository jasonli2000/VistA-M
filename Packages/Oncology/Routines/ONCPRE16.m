ONCPRE16 ;Hines CIOFO/WAA - Pre-Install for Patch ONC*2.11*16;1/29/98
 ;;2.11;Oncology;**16**;Mar 07, 1995
EN1 ;This routine will loop though the ONCOLOGY PRIMARY file, find all of
 ;the 2000000 and 2999999 date values and convert them to "0000000" and 
 ;9999999 respectively.
 N IEN
 S IEN=0
 F  S IEN=$O(^ONCO(165.5,IEN)) Q:IEN'>0  D D1655(IEN)
 Q
D1655(IEN) ;ONCOLOGY PRIMARY (165.5)
 N OLDLINE,NEWLINE
 L +^ONCO(165.5,IEN)
 S (OLDLINE(0),NEWLINE(0))=$G(^ONCO(165.5,IEN,0))
 S (OLDLINE(1),NEWLINE(1))=$G(^ONCO(165.5,IEN,1))
 S (OLDLINE(2.2),NEWLINE(2.2))=$G(^ONCO(165.5,IEN,2.2))
 S (OLDLINE(3),NEWLINE(3))=$G(^ONCO(165.5,IEN,3))
 S (OLDLINE(3.1),NEWLINE(3.1))=$G(^ONCO(165.5,IEN,3.1))
 S (OLDLINE(5),NEWLINE(5))=$G(^ONCO(165.5,IEN,5))
 S (OLDLINE(7),NEWLINE(7))=$G(^ONCO(165.5,IEN,7))
 S (OLDLINE("BLA1"),NEWLINE("BLA1"))=$G(^ONCO(165.5,IEN,"BLA1"))
 S (OLDLINE("BLA2"),NEWLINE("BLA2"))=$G(^ONCO(165.5,IEN,"BLA2"))
 S (OLDLINE("THY1"),NEWLINE("THY1"))=$G(^ONCO(165.5,IEN,"THY1"))
 S (OLDLINE("STS2"),NEWLINE("STS2"))=$G(^ONCO(165.5,IEN,"STS2"))
 S (OLDLINE("NHL2"),NEWLINE("NHL2"))=$G(^ONCO(165.5,IEN,"NHL2"))
 S:$P(NEWLINE(1),U,10)'="" $P(NEWLINE(1),U,10)=$$FIX($P(OLDLINE(1),U,10)) ;17 SUSPENSE
 S:$P(NEWLINE(3),U,1)'="" $P(NEWLINE(3),U,1)=$$FIX($P(OLDLINE(3),U,1))   ;50 SURG OF PRIM SITE
 S:$P(NEWLINE(3),U,4)'="" $P(NEWLINE(3),U,4)=$$FIX($P(OLDLINE(3),U,4))   ;51 RADIATION
 S:$P(NEWLINE(3),U,8)'="" $P(NEWLINE(3),U,8)=$$FIX($P(OLDLINE(3),U,8))   ;52 RADIATION TO CNS
 S:$P(NEWLINE(3),U,11)'="" $P(NEWLINE(3),U,11)=$$FIX($P(OLDLINE(3),U,11)) ;53 CHEMOTHERAPY
 S:$P(NEWLINE(3),U,14)'="" $P(NEWLINE(3),U,14)=$$FIX($P(OLDLINE(3),U,14)) ;54 HORMONE THERAPY
 S:$P(NEWLINE(3),U,17)'="" $P(NEWLINE(3),U,17)=$$FIX($P(OLDLINE(3),U,17)) ;55 IMMUNOTHERAPY
 S:$P(NEWLINE(3),U,23)'="" $P(NEWLINE(3),U,23)=$$FIX($P(OLDLINE(3),U,23)) ;57 OTHER TREATMENT
 S:$P(NEWLINE(3),U,31)'="" $P(NEWLINE(3),U,31)=$$FIX($P(OLDLINE(3),U,31)) ;58.3 NON CA-DIR SURG
 I $G(^ONCO(165.5,IEN,4,0))'="" N X S X=0 F  S X=$O(^ONCO(165.5,IEN,4,X)) Q:X<1  D
 .N LINE ;165.51 SUBSEQUENT COURSE OF TREATMENT subfile
 .S LINE(0)=$G(^ONCO(165.5,IEN,4,X,0))
 .S LINE(2)=$G(^ONCO(165.5,IEN,4,X,2))
 .S:$P(LINE(0),U,1)'="" $P(LINE(0),U,1)=$$FIX($P(LINE(0),U,1))   ;.01  INITIATION DATE
 .S:$P(LINE(0),U,17)'="" $P(LINE(0),U,17)=$$FIX($P(LINE(0),U,17)) ;.031 RAD TO CNS DATE
 .S:$P(LINE(0),U,11)'="" $P(LINE(0),U,11)=$$FIX($P(LINE(0),U,11)) ;.041 SURG OF PRIM SITE DT
 .S:$P(LINE(0),U,12)'="" $P(LINE(0),U,12)=$$FIX($P(LINE(0),U,12)) ;.051 RADIATION DATE
 .S:$P(LINE(0),U,13)'="" $P(LINE(0),U,13)=$$FIX($P(LINE(0),U,13)) ;.061 CHEMOTHERAPY DATE
 .S:$P(LINE(0),U,14)'="" $P(LINE(0),U,14)=$$FIX($P(LINE(0),U,14)) ;.071 HORMONE/STEROID DATE
 .S:$P(LINE(0),U,15)'="" $P(LINE(0),U,15)=$$FIX($P(LINE(0),U,15)) ;.081 IMMUNOTHERAPY DATE
 .S:$P(LINE(0),U,16)'="" $P(LINE(0),U,16)=$$FIX($P(LINE(0),U,16)) ;.091 OTH CA THERAPY DATE
 .S:$P(LINE(2),U,31)'="" $P(LINE(2),U,31)=$$FIX($P(LINE(2),U,31)) ;34   REC/RES DELALYED DATE
 .S:LINE(0)'="" ^ONCO(165.5,IEN,4,X,0)=LINE(0)
 .S:LINE(2)'="" ^ONCO(165.5,IEN,4,X,2)=LINE(2)
 .Q
 S:$P(NEWLINE(5),U,1)'="" $P(NEWLINE(5),U,1)=$$FIX($P(OLDLINE(5),U,1)) ;70 FIRST RECURRENCE
 I $G(^ONCO(165.5,IEN,23,0))'="" N X S X=0 F  S X=$O(^ONCO(165.5,IEN,23,X)) Q:X<1  D
 .N LINE ;165.572 SUBSEQUENT RECURRENCES subfile
 .S LINE(0)=$G(^ONCO(165.5,IEN,23,X,0))
 .S:$P(LINE(0),U,1)'="" $P(LINE(0),U,1)=$$FIX($P(LINE(0),U,1)) ;.01 DATE OF SUBSEQUENT REC
 .S:LINE(0)'="" ^ONCO(165.5,IEN,23,X,0)=LINE(0)
 .K ^ONCO(165.5,IEN,23,"B",2000000,X)
 .K ^ONCO(165.5,IEN,23,"B",2999999,X)
 .S DOSR=$P(^ONCO(165.5,IEN,23,X,0),U,1)
 .S ^ONCO(165.5,IEN,23,"B",DOSR,X)=""
 .K DOSR Q
 S:$P(NEWLINE(0),U,24)'="" $P(NEWLINE(0),U,24)=$$FIX($P(OLDLINE(0),U,24))   ;79  SCREENING DATE
 S:$P(NEWLINE(7),U,1)'="" $P(NEWLINE(7),U,1)=$$FIX($P(OLDLINE(7),U,1))     ;90  ABSTRACT DATE
 S:$P(NEWLINE(7),U,5)'="" $P(NEWLINE(7),U,5)=$$FIX($P(OLDLINE(7),U,5))     ;94  REPORTING DATE
 S:$P(NEWLINE(0),U,27)'="" $P(NEWLINE(0),U,27)=$$FIX($P(OLDLINE(0),U,27))   ;121 CANCER CONF
 S:$P(NEWLINE(3.1),U,2)'="" $P(NEWLINE(3.1),U,2)=$$FIX($P(OLDLINE(3.1),U,2)) ;130 RADIATION AUX
 S:$P(NEWLINE(2.2),U,1)'="" $P(NEWLINE(2.2),U,1)=$$FIX($P(OLDLINE(2.2),U,1)) ;137 1ST BIOPSY
 S:$P(NEWLINE("BLA1"),U,24)'="" $P(NEWLINE("BLA1"),U,24)=$$FIX($P(OLDLINE("BLA1"),U,24)) ;323 ONSET OF SYMPTOMS
 S:$P(NEWLINE("BLA2"),U,16)'="" $P(NEWLINE("BLA2"),U,16)=$$FIX($P(OLDLINE("BLA2"),U,16)) ;361 DATE RADIATION THERAPY ENDED
 S:$P(NEWLINE("BLA2"),U,22)'="" $P(NEWLINE("BLA2"),U,22)=$$FIX($P(OLDLINE("BLA2"),U,22)) ;367 DATE CHEMOTHERAPY ENDED
 S:$P(NEWLINE("THY1"),U,36)'="" $P(NEWLINE("THY1"),U,36)=$$FIX($P(OLDLINE("THY1"),U,36)) ;435 DATE OF DISCHARGE AFTER SURG
 S:$P(NEWLINE("STS2"),U,12)'="" $P(NEWLINE("STS2"),U,12)=$$FIX($P(OLDLINE("STS2"),U,12)) ;541 DATE BRACHYTHERAPY STARTED
 S:$P(NEWLINE("STS2"),U,13)'="" $P(NEWLINE("STS2"),U,13)=$$FIX($P(OLDLINE("STS2"),U,13)) ;542 DATE BRACHYTHERAPY ENDED
 S:$P(NEWLINE("STS2"),U,38)'="" $P(NEWLINE("STS2"),U,38)=$$FIX($P(OLDLINE("STS2"),U,38)) ;567 DATE EXT BEAM RAD STARTED
 S:$P(NEWLINE("NHL2"),U,20)'="" $P(NEWLINE("NHL2"),U,20)=$$FIX($P(OLDLINE("NHL2"),U,20)) ;865 SYSTEMIC CHEMOTHERAPY DATE
 S:OLDLINE(0)'=NEWLINE(0) ^ONCO(165.5,IEN,0)=NEWLINE(0)
 S:OLDLINE(1)'=NEWLINE(1) ^ONCO(165.5,IEN,1)=NEWLINE(1)
 S:OLDLINE(2.2)'=NEWLINE(2.2) ^ONCO(165.5,IEN,2.2)=NEWLINE(2.2)
 S:OLDLINE(3)'=NEWLINE(3) ^ONCO(165.5,IEN,3)=NEWLINE(3)
 S:OLDLINE(3.1)'=NEWLINE(3.1) ^ONCO(165.5,IEN,3.1)=NEWLINE(3.1)
 S:OLDLINE(5)'=NEWLINE(5) ^ONCO(165.5,IEN,5)=NEWLINE(5)
 S:OLDLINE(7)'=NEWLINE(7) ^ONCO(165.5,IEN,7)=NEWLINE(7)
 S:OLDLINE("BLA1")'=NEWLINE("BLA1") ^ONCO(165.5,IEN,"BLA1")=NEWLINE("BLA1")
 S:OLDLINE("BLA2")'=NEWLINE("BLA2") ^ONCO(165.5,IEN,"BLA2")=NEWLINE("BLA2")
 S:OLDLINE("THY1")'=NEWLINE("THY1") ^ONCO(165.5,IEN,"THY1")=NEWLINE("THY1")
 S:OLDLINE("STS2")'=NEWLINE("STS2") ^ONCO(165.5,IEN,"STS2")=NEWLINE("STS2")
 S:OLDLINE("NHL2")'=NEWLINE("NHL2") ^ONCO(165.5,IEN,"NHL2")=NEWLINE("NHL2")
 K ^ONCO(165.5,"ATX",IEN)
 K ^ONCO(165.5,"AAD",2000000,IEN)
 K ^ONCO(165.5,"AAD",2999999,IEN)
 ;Re-index this entry
 S DIK="^ONCO(165.5,",DA=IEN,DIK(1)=50 D EN1^DIK
 S DIK="^ONCO(165.5,",DA=IEN,DIK(1)=51 D EN1^DIK
 S DIK="^ONCO(165.5,",DA=IEN,DIK(1)=52 D EN1^DIK
 S DIK="^ONCO(165.5,",DA=IEN,DIK(1)=53 D EN1^DIK
 S DIK="^ONCO(165.5,",DA=IEN,DIK(1)=54 D EN1^DIK
 S DIK="^ONCO(165.5,",DA=IEN,DIK(1)=55 D EN1^DIK
 S DIK="^ONCO(165.5,",DA=IEN,DIK(1)=57 D EN1^DIK
 S DIK="^ONCO(165.5,",DA=IEN,DIK(1)=90 D EN1^DIK
 L -^ONCO(165.5,IEN)
 Q
FIX(DATE) ;Conversion function
 N NDATE
 S NDATE=$S(DATE="2000000":"0000000",DATE="2999999":"9999999",1:DATE)
 Q NDATE
