PRSCY ;HISC/GWB-ROUTINE TO REMOVE CY CODES FROM 8B STRINGS ;01/04/94
 ;;3.1;PAID;;Feb 25, 1994
 S PP=0,PP=$O(^PRST(458,"B","94-26",PP))
EMP S DIC="^PRST(458,PP,""E"",",DIC(0)="AEQZ" D ^DIC G:($D(DTOUT))!($D(DUOUT))!(X="") EXIT G:Y=-1 EMP
 S IEN=+Y
 I $D(^PRST(458,PP,"E",IEN,5)) S RCD8B=^PRST(458,PP,"E",IEN,5),CODES=$E(^PRST(458,PP,"E",IEN,5),32,999) I CODES["CY" D
 .S CYVAL=$E(CODES,$F(CODES,"CY"),$F(CODES,"CY")+2)
 .S CDVAL=$E(CODES,$F(CODES,"CD"),$F(CODES,"CD")+5)
 .W !!,"OLD 8B  ",RCD8B
 .S RCD8B=$E(RCD8B,1,31)_$E(CODES,1,$F(CODES,"CY")-3)_$E(CODES,$F(CODES,"CY")+3,999)
 .S CDVAL=CDVAL-CYVAL,CDVAL=$E("000000",$L(CDVAL)+1,6)_CDVAL
 .S RCD8B=$E(RCD8B,1,$F(RCD8B,"CD")-1)_CDVAL
 .S ^PRST(458,PP,"E",IEN,5)=RCD8B
 .W !!,"NEW 8B  ",RCD8B
 .S $P(^PRST(458,PP,"E",IEN,0),"^",2)="P"
 G EMP
EXIT D KILL^XUSCLEAN
