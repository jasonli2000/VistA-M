DGMT6 ;ALB/JDS - MEANS TEST ; 01 JAN 86
 ;;MAS VERSION 5.1;
INP S I=$E(DGINP,C) S:I?1U I=$A(I)-55 G OUT:'I S (DGO,S)=0,D2=D2+1 S:D2=91 D2=1 D S S DGHEAD="INPATIENT CARE "_S,I2=$E(DGINP,C+1) S:I2?1U I2=$A(I2)-55 I 'I1,(I2'=I) D INPC G DISPL
 I 'I1,I2 D INPC G DISPL:DGPD!(D2=90)!(D3=365) S I1=I,DGDH=$E(D,4,5)_"/"_C Q
 I I1,'I2 D INPC G DISPL
 D INPC G DISPL:DGPD!(D2=90)!(D3=365) Q
OUT S I=$E(DGOUT,C) G FEE:'I S DGO=1 D S S DGHEAD="OUTPATIENT "_S D OUTC G DISPL
FEE S I=$E(DGFB,C) G FEI:'I S DGHEAD="FEE BASIS" D FEEC G DISPL
FEI Q:'$D(DGFBI)  S I=$P(DGFBI,U,C) Q:'I  S D2=D2+1,DGHEAD="INPATIENT CARE (FEE)" S:D2=91 D2=1
 I D2=1 S (DGMAXI,DGMAXN)=$P(DGMT,U,9) S:DGINPP DGMAXI=DGMAXI/2 S DGINPP=1
 Q:'DGMAXQ  S DGPD=I,DGPD=$S(DGPD<DGMAXI:DGPD,1:DGMAXI),DGPD=$S(DGPD<DGMAXQ:DGPD,1:DGMAXQ),DGMAXQ=DGMAXQ-DGPD,DGMAXN=DGMAXN-DGPD,DGMAXI=DGMAXI-DGPD S:DGMAXQ<0 DGMAXQ=0 S:DGMAXI<0 DGMAXI=0 S:DGMAXN<0 DGMAXN=0 G DISPL
COST ;
INPC I D2=1 S (DGMAXI,DGMAXN)=$P(DGMT,U,9) S:DGINPP DGMAXI=DGMAXI/2 S DGINPP=1
 Q:'DGMAXQ  S DGPD=+$P(DGMT1,U,I+2),N=$S(I=5:DGMAXN,1:DGMAXI),DGPD=$S(DGPD<N:DGPD,1:N),DGPD=$S(DGPD<DGMAXQ:DGPD,1:DGMAXQ),DGMAXQ=DGMAXQ-DGPD,DGMAXN=DGMAXN-DGPD,DGMAXI=DGMAXI-DGPD S:DGMAXQ<0 DGMAXQ=0 S:DGMAXI<0 DGMAXI=0 S:DGMAXN<0 DGMAXN=0
 Q
OUTC S DGPD=$P(DGMT1,U,2),DGPD=$S(DGMAXQ<DGPD:DGMAXQ,1:DGPD) S DGMAXQ=DGMAXQ-DGPD S:DGMAXQ<0 DGMAXQ=0 Q
FEEC G OUTC:I=1 S DGPD=$P(DGFBC,U,C),DGPD=+$S(DGMAXQ<DGPD:DGMAXQ,1:DGPD),DGMAXQ=DGMAXQ-DGPD
 Q
DISPL S DGT=DGT+DGPD,DGMAX3=DGMAX3+DGPD,DGDH=$S(DGDH:DGDH_"-"_C_"/",1:$E(D,4,5)_"/"_C_"/")_$E(D,2,3) W !,DGDH,?20,DGHEAD,?45,$S('DGPD:"------",1:$J($J(DGPD,3,2),6)),?60,$J(D1,2),?65,$J(D2,2),?70,$J(D3,3)
 S (I1,DGPD,DGDH)=0 I $Y>(IOSL-3) D H,HEAD
 Q
ST S (D1,D2,D3,DGDH,DGMAX3)=0,DGMT=$S($D(^DG(43,1,"MT",$E(DGSD,1,3)_"0000",0)):^(0),1:0),DGMAXQ=$P(DGMT,U,9),(DGMAXI,DGMAXN)=DGMAXQ,(DGINPP,DGPD)=0 D SET1:DGSD=DGAS S DGMT1=$N(^DG(43,1,"MT1",9999999-DGSD)),DGMT1=$S($D(^(DGMT1,0)):^(0),1:0)
 F D=DGSD:100:$E(DGE,1,5)_"32" S:$E(D,4,5)=13 D=$E(D,1,3)+1_"0100" S E=$S($D(^DG(41.3,DFN,4,$E(D,1,5)_"00",0)):^(0),1:0),I1=0,DGINP=$P(E,U,8),DGOUT=$P(E,U,9),DGFB=$P(E,U,10),DGFBC=$S($D(^(1)):^(1),1:0) K DGFBI S:$D(^(2)) DGFBI=^(2) D ST1 Q:'DN
 Q
ST1 S DGI=0 I ($S($L(DGINP):DGINP'?31"0",1:DGINP)!$S($L(DGOUT):DGOUT'?31"0",1:DGOUT)!$S($L(DGFB):DGFB'?31"0",1:DGFB)) S DGI=1
 S:'DGI&($D(DGFBI)) DGI=1 S A=1 S:D=DGSD A=+$E(D,6,7) S:'A A=1 S X=D X DGDIM S A1=X S:$E(D,1,5)=$E(DGE,1,5) A1=+$E(DGE,6,7)
 S Z=0 I $D(^DG(43,1,"MT1","AB",$E(D,1,5))) S Z=$N(^($E(D,1,5),0)),Z1=^DG(43,1,"MT1",Z,0),Z=+$E(Z1,6,7)
 F C=A:1:A1 S D1=D1+1,D3=D3+1 D D:D1=91!(D3=366) D NEW:(Z=C),INP:DGI,SET:C=X Q:'DN  I C=X,DGDH D DISPL
 Q
S S S="("_$P($S(DGO:"APP^UNS^REG",1:"MED^SUR^SCI^PSY^NH^INT^REH^BLI^NEU^ALC"),U,I)_")" Q
D I D1=91 S D1=1,DGMAXQ=+$P(DGMT,U,9) I D3>359,DGMAX3>(3*DGMAXQ) S DGMAXQ=DGMAX3-(3*DGMAXQ)
 S:D3=366 D3=1,D1=1,(DGMAX3,D2)=0,DGINPP=0,DGMT=$S($D(^DG(43,1,"MT",$E(D,1,3)_"0000",0)):^(0),1:0),DGMAXQ=$P(DGMT,U,9),(DGMAXI,DGMAXN)=DGMAXQ Q
HEAD W !!?45,"PAYMENT ",?60,"90   INP  365 ",!?45,"DUE",?60,"DAY  DAY  DAY",!?45,"-------       ----- ---- ----"
 W !
 Q
H I $E(IOST,1)="C" W *7 R K:DTIME I K=U S DN=0 Q
 S DC=DC+1 W @IOF,! X:$D(^UTILITY($J,2)) ^(2) W ! F K=1:1:IOM W "_"
 W !,"("_$P(^DPT(DFN,0),U,1)_")",!
 Q
DT I Y W $P("JAN^FEB^MAR^APR^MAY^JUN^JUL^AUG^SEP^OCT^NOV^DEC",U,$E(Y,4,5))," " W:Y#100 $J(Y#100\1,2),"," W Y\10000+1700 W:Y#1 "  ",$E(Y_0,9,10),":",$E(Y_"000",11,12)
 Q
SET Q:'$D(^DG(41.3,DFN,4,$E(D,1,5)_"00",0))  S $P(^(0),U,14)=1 F I=2:1:7,13 S $P(^(0),U,I)=@($P("DGMAXI^DGMAXN^DGMAXQ^D1^D2^D3^^^^^^DGMAX3",U,I-1))
 Q
SET1 S X1=DGAS,X2=-1 D C^%DTC Q:'$D(^DG(41.3,DFN,4,$E(X,1,5)_"00",0))  F I=5:1:7 S @("D"_(I-4))=$P(^(0),U,I)
 I D1 S:D2 DGINPP=1 F I=2:1:4,13 S @($P("DGMAXI^DGMAXN^DGMAXQ^DGMAX3",U,$S(I<5:I-1,1:4)))=$P(^DG(41.3,DFN,4,$E(X,1,5)_"00",0),U,I)
 I D3 S X1=DGAS,X2=-1*D3 D C^%DTC I $E(X,1,3)'=$E(DGSD,1,3) S DGMT=$S($D(^DG(43,1,"MT",$E(X,1,3)_"0000",0)):^(0),1:0)
 Q
NEW S DGMT1=Z1 W !,$E(D,4,5)_"/"_C_"/"_$E(D,2,3),?20,"New billing rates in effect"
