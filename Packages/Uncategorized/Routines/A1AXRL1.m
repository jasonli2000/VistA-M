A1AXRL1 ;SLL/ALB ISC; FACILITY RECOMMENDATION LIST WITHIN DATE RANGE; 3/11/88
 ;;VERSION 1.0
 ;
LOOP ;
 S AC=1
 S AU="" F II=0:0 S AU=$O(^DIZ(11830,"RECOM",AU)) Q:AU=""  F AA=0:0 S AA=$N(^DIZ(11830,"RECOM",AU,AA)) Q:AA<0  F AP=0:0 S AP=$N(^DIZ(11830,"RECOM",AU,AA,AP)) Q:AP<0  D LOOP1
 D ^A1AXRL2
 Q
LOOP1 ;
 F AS=0:0 S AS=$N(^DIZ(11830,"RECOM",AU,AA,AP,AS)) Q:AS<0  F AR=0:0 S AR=$N(^DIZ(11830,"RECOM",AU,AA,AP,AS,AR)) Q:AR<0  D SET
 Q
SET ;
 I DUZ(2)>999&(DUZ(2)<9999) Q:'$D(^DIZ(11830,AA,"D"))  Q:$P(^("D"),"^",1)=""
 I DUZ(2)'>999 Q:DUZ(2)'=^DIZ(11830,AA,"F")
 S A1AXDT=+^DIZ(11830,AA,0) Q:A1AXDT<A1AXLDT!(A1AXDT>A1AXUDT)  S A1AXDT=$E(A1AXDT,4,5)_"/"_$E(A1AXDT,6,7)_"/"_$E(A1AXDT,2,3)
 S A1AXF=$P(^DIZ(11837,+^DIZ(11830,AA,"F"),0),"^",1),A1AXD=$P(^(0),"^",2)
 S A1AXO=$P(^DIZ(11831,+^DIZ(11830,AA,"O"),0),"^",1)
 S A1AXPARA=$S($D(^DIZ(11830,AA,"P",AP,"S",AS,"R",AR,11)):$P(^(11),"^",5),1:"")
 S A1AXP=$S($D(^DIZ(11830,AA,"P",AP,0)):$P(^DIZ(11832,+^(0),0),"^",1),1:"")
 S A1AXS=$S($D(^DIZ(11830,AA,"P",AP,"S",AS,0)):$P(^DIZ(11835,+^(0),0),"^",1),1:"")
 I A1AXOPT="F" S A1AX1=A1AXF,A1AX2=A1AXO
 I A1AXOPT="O" S A1AX1=A1AXO,A1AX2=A1AXF
 S ^UTILITY($J,"RL",A1AXD,A1AX1,A1AX2,AU,AC)=AU_"^"_A1AXDT_"^"_A1AXP_"^"_A1AXS_"^"_A1AXPARA,AC=AC+1
 Q
