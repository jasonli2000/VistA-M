A1CB1 ;ISC1/JAS;SET THE BEGINNING TIME OF ZTRTN [ 12/22/92  10:19 AM ]
 ;;V1.0
 N X,Y,%,BEG,END,NUM
 S $P(^%A1CB(ZTSK),"^",3)=A1CBTIME
 S %H=A1CBTIME D YMD^%DTC
 S A1CBSTRT=X_%
 S ^%A1CB("START",A1CBSTRT,ZTSK)=""
 Q
TRAP ; ERROR TRAP SET UP LOGGING AND REVERSION
 S $P(^%A1CB(ZTQUEUED),"^",4)=$H
 S $P(^%A1CB(ZTQUEUED),"^",10)="*"
 S X="",@^%ZOSF("TRAP")
 Q
ERR ; ERROR LOGGING WHEN REQUEING OCCURS
 S NUM=$P(^%A1CB(ZTSK),"^",11)
 S $P(^%A1CB(ZTSK),"^",11)=NUM+1
 S $P(^%A1CB(ZTSK),"^",10)="R"
 S $P(^%A1CB(ZTSK),"^",6)=ZTDTH
 S A1CB3=$P(^%A1CB(ZTSK),"^",3) S %H=A1CB3 D YMD^%DTC S A1CB3=X_%
 S %H=A1CB3 D YX^%DTC S BEG=Y
 S %H=A1CBEND D YX^%DTC S END=Y
 S ^%A1CB("ZTQ",A1CB3,ZTSK)=A1CB3_"^"_END
 K A1CB3,A1CBEND
 Q
