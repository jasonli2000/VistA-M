A1CHRVW ;ALB/ - REVIEW MEANS TST DATA PRIOR TO TRANSMISSION ; JAN 9 1989 @ 1053
 ;;V 1.3
 S:$D(^UTILITY("A1CH","O"))=0 ^("O")=""
 S:$D(^UTILITY("A1CH","I"))=0 ^("I")=""
 I (^UTILITY("A1CH","O")=0)!(^UTILITY("A1CH","I")=0) W !,"Process already started - retry after it terminates" Q
 S ZRT=0,DGPGM="EN^A1CHRVW",DGVAR="ZRT" D ZIS^DGUTL G:POP END
EN U IO D 0
END X:'POP ^%ZIS("C") I IO'=IO(0) U IO(0)
 K A,A1,A2,H1,DGBD,DGDV,DGDVN,DGJB,DGND,DGPGM,DGTN,DGTOUT,DGVAR,H1,I,T2,WK,WX,X,X1,Z,ZX
 Q
0 S U="^",H1=$H F ZX=1:1:3 D:$D(^UTILITY("A1CH",ZX))>0 1
 Q
1 ;print out current data
 S WX=0,A2=0,WX=$O(^UTILITY("A1CH",ZX,WX)),A=$S(ZX=1:"OUTPATIENT",ZX=2:"INPATIENT",1:0) W:$D(^(WX))<10 !,"NO "_A_" DATA FOR THIS RANGE OF DATES" H 1 Q:$D(^(WX))<10
 I ZX=1 S A2=1 D DIV
 I ZX=2 S X1=0 F I=1:1 S X1=$O(^UTILITY("A1CH","AI",X1)) Q:X1=""  S X=^UTILITY("A1CH","AI",X1),Z($P(X,U,2))=$P(X,U,3),A(I)=$P(X,U,1)_U_$P(X,U,2)
 D:ZX=2 DIV1
 I ZX=2 S A2=^UTILITY("A1CH","AI",0),DGDV=+DGDV,DGTN=1,K1=1,Z=$P(WX,U,7),DGTOUT=$P(WX,U,8),DGDVN=$P(^DG(40.8,1,0),U,1) D ^A1CHIP2 Q
 S DGTN=3,A1=0,DGTOUT=$P(WX,U,7) F I=1:1 S A1=$O(^DG(40.8,A1)) Q:(A1="")!(A1'?.N)  S A(I)=^DG(40.8,A1,0),A2=I,DGDV=$E($P(A(I),U,2)_"     ",1,5)
 D ^A1CHOP2
 Q
DIV S X=0 F I=A2:1 S X=$O(^DG(40.8,X)) Q:(X="")!(X'?.N)  S A(I)=^DG(40.8,X,0),A2=I
 S WK=$S(ZX=1:$P(A(1),U,2),ZX=2:$P(A(A2+1),U,2),1:0),WX=$S(ZX=1:^UTILITY("A1CH",ZX,1,$E(WK_"     ",1,5)),ZX=2:^UTILITY("A1CH",ZX,1,+WK),1:0)
 S T2=$P(WX,U,2),DGDV=$P(WX,U,3),DGJB=ZX,DGBD=$P(WX,U,5),DGND=$P(WX,U,6)
 Q
DIV1 S WK=$P(A(1),U,2),WX=^UTILITY("A1CH",ZX,1,WK)
 S T2=$P(WX,U,2),DGDV=$P(WX,U,3),DGJB=ZX,DGBD=$P(WX,U,5),DGND=$P(WX,U,6)
 Q
