A4AA433 ;ISC4/JJM - PROGRAM TO AUDIT FILE 433 ; 7/15/99 13:35
 ;;0.0;**** CLASS III ****;;JUNE 16, 1995
HSK S ERRCNT=0
 S CNT=0
 S TN=0
 D NOW^%DTC
 W !,"JOB STARTED: ",%
 W !,^PRCA(433,0)
START F  S TN=$O(^PRCA(433,TN)) Q:'TN  S CNT=CNT+1 W:(CNT#1000)=0 "." D
 .  ; W !,"TRANSACTION NUMBER: ",TN
 .  S T433N0=$G(^PRCA(433,TN,0))
 .  S BN=$P(T433N0,"^",2)
 .  S T433N8=$P($G(^PRCA(433,TN,8)),"^",1,5)
 .  IF 'BN D  QUIT
 .. S ERRCNT=ERRCNT+1
 ..  W !,$J(ERRCNT,5),?6,"TRANSACTION # ",TN," HAS A STATUS OF ",$S(STATUS=1:"INCOMPLETE",STATUS=2:"COMPLETED ",1:"MISSING   ")," WITH NO BILL NUMBER (",CNT,")"
 .  S AR430N0=$G(^PRCA(430,BN,0))
 .  IF AR430N0="" D  QUIT
 ..  S ERRCNT=ERRCNT+1
 ..  W !,$J(ERRCNT,8),?10,"TRANSACTION ",TN," MISSING BILL NUMBER ",BN," IN FILE 430 (",CNT,")"
 .  S ARBILL=$P(AR430N0,"^",1)
 .  S STATUS=$P(T433N0,"^",4)
 .  S ARPAT=$P(AR430N0,"^",7)
 .  S ARDEB=$P(AR430N0,"^",9)
 .  S:ARDEB'="" ARPAT=+$P($G(^RCD(340,ARDEB,0)),"^",1)
 .  S IBIEN=$O(^IB("AT",TN,0))
 .  Q:IBIEN=""
 .  S IB350N0=$G(^IB(IBIEN,0))
 .  S IBBN=$P(IB350N0,"^",1)
 .  S IBPAT=$P(IB350N0,"^",2)
 .  S IBBILL=$P(IB350N0,"^",11)
 .  S IBTN=$P(IB350N0,"^",12)
 .  IF (IBBILL'=ARBILL)!(IBTN'=TN)!(IBPAT'=ARPAT) D
 ..  S ERRCNT=ERRCNT+1
 ..  W !,$J(ERRCNT,8),?10,"*****    BILL NUMBER ERROR ***** (",CNT,")"
 ..  W !,"AR DATA:",?10,$J(TN,8),?20,ARBILL,"(",BN,")",?45,ARPAT
 ..  W !,"IB DATA:",?10,$J(IBTN,8),?20,IBBILL,"(",IBIEN,")",?45,IBPAT,!
 .  Q:T433N8=""
 .  S T430N7=$P($G(^PRCA(430,BN,7)),"^",1,5)
 .  W:T433N8'=T430N7 !,?5,T433N8,"  ",T430N7
EOJ ;
 D NOW^%DTC
 W !,"EOJ-",CNT,"  ",%
 K AR430N0,ARBILL,ARDEB,ARPAT,BN,CNT,ERRCNT,IB350N0,IBBILL,IBBN,IBIEN
 K IBPAT,IBTN,STATUS,T430N7,T433N0,T433N8,TN
 K CS,DIC,PFLAG,PROMPT,Y
 QUIT
RESTART S CNT=246358
 S ERRCNT=61
 S TN=246610
 D START
PROMPT ;
 S TN=""
 F  D  Q:('Y)!('$D(TN))
    . D EN1
    . Q:'Y
    . S PROMPT=1
    . S CNT=0
    . D START
 QUIT
EN1 ;
 S PFLAG=0
 S DIC="^PRCA(433,",DIC(0)="AEMNQZ" D ^DIC
 Q:Y=-1
 S TN=(+Y)
 W !,^PRCA(433,TN,0)
 S U="^"
 S TN=TN-1
EXIT ;;
 QUIT
