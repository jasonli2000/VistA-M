A4AARPT7 ;HINES-CIOFO/JJM - ROUTINE TO CHECK BILL BALANCE; 5/6/99 11:15
 ;;1.0;**** CLASS III ****;;JUN 30, 1998
 S:'$G(BILL) BILL=$G(BN)
 Q:'$G(BILL)
 S RBAL=0,BAL=0
 D GETLSD^A4AARPT5
 S F430N0=$G(^PRCA(430,BILL,0))
 S CAT=$P(^PRCA(430,BILL,0),U,2)
 S CS=$P(^PRCA(430,BILL,0),U,8)
 Q:(CS=15)!(CS=18)!(CS=20)!(CS=27)!(CS=48)!(CS=49)
 ; Q:(CS=15)!(CS=18)!(CS=20)!(CS=27)!(CS=40)!(CS=48)!(CS=49)
 S RBAL=+$P(^PRCA(430,BILL,0),U,3)
 S DATE2=$P($P($G(^PRCA(430,BILL,6)),U,21),".")
 S:DATE2="" DATE2=$P($P($G(^PRCA(430,BILL,0)),U,10),".")
 S TIME2="."_$P($P($G(^PRCA(430,BILL,6)),U,21),".",2)
 S:TIME2="." TIME2=0
 D CALCCBAL^A4AARPT
 D PTRANS
 ; W:BAL'=RBAL !,"****  INCORRECT BILL BALANCE  ****",!,BILL,"  ",$P(F430N0,U,1),"  CAT = ",$P(F430N0,U,2),"  STATUS= ",$P(F430N0,U,8)," ****"
 QUIT
PTRANS ; PROCESS BILL TRANSACTIONS
 S TRANS=""
 F  S TRANS=$O(^PRCA(433,"C",BILL,TRANS)) Q:('TRANS)  D CALCBB
 QUIT
CALCBB ;
 S BS=" "
 S F433N0=$G(^PRCA(433,TRANS,0))
 S F433N1=$G(^PRCA(433,TRANS,1))
 S F433N8=$G(^PRCA(433,TRANS,8))
 S TYPE=$S($P((F433N1),U,2)'="":$P((F433N1),U,2),1:BS)
 S TAMT=+$P((F433N1),U,5)
 S RFLAG=""
 I "^1^12^13^43^"[("^"_TYPE_"^") S:TAMT>0 TAMT=+TAMT S RFLAG=1
 I "^2^8^9^10^11^14^26^29^34^35^41^"[("^"_TYPE_"^") S:TAMT>0 TAMT=+TAMT/-1 S RFLAG=1
 I TYPE=14,TAMT<0 S TAMT=TAMT
 S:$P(^PRCA(430,BILL,0),U,2)=26 TAMT=TAMT*-1
 S:$P(F433N1,U,2)=25 TAMT=TAMT*1
 ; D:$D(F433N8)'=0 CALC
 S DATE2=$S($P($P(F433N1,U,9),".")'="":$P($P(F433N1,U,9),"."),$P($P(F433N1,U,1),".")'="":$P($P(F433N1,U,1),"."),1:"")
 S TIME2="."_$S($P($P(F433N1,U,9),".",2)'="":$P($P(F433N1,U,9),".",2),$P($P(F433N1,U,1),".",2)'="":$P($P(F433N1,U,1),".",2),1:"")
 S:TIME2="." TIME2=0
 S ITF=$P(F433N0,U,10)
 S ITF=$S(ITF="":" ",1:"I")
 S:($P(F433N1,U,2)=25) ITF=ITF_"R"
 ; S:(ITF'["I")&(ITF'["R")&(RFLAG=1) RBAL=RBAL+TAMT S A4AFRB=RBAL
 I (ITF'["R")&(RFLAG=1) S RBAL=RBAL+TAMT S A4AFRB=RBAL
 S DATE3=$S($P($P(F433N1,U,1),".")'=$P($P(F433N1,U,9),"."):$P($P(F433N1,U,9),"."),1:"")
 QUIT
CALC ;
 S BAL=0
 Q:$D(F433N8)=0
 S PRCA4338=F433N8
 S PB=$P(PRCA4338,U,1)
 S IB=$P(PRCA4338,U,2)
 S AB=$P(PRCA4338,U,3)
 S MF=$P(PRCA4338,U,4)
 S CC=$P(PRCA4338,U,5)
 S EP=$P(PRCA4338,U,7)
 S CA=$P(PRCA4338,U,8)
 S BAL=PB+IB+AB+MF+CC+EP+CA
 K PRCA4338
 QUIT
P430D ;HINES-CIOFO/JJM - PRINT FILE 430 DATA 2/11/99 11:45
 ;;1.0;**** CLASS III ****;;JUN 30, 1998
 ;
 ;
 ; CHECK FOR IEN FOR BILL
 Q:'$G(BILL)
 N BAL,PRCA4307,PB,IB,AB,MF,CC
 S LINE="",$P(LINE,"-",60)=""
 D DMCAMT^A4AADMC
 W !,?10,"DATE",?20,"PRINCIPLE",?30," INTEREST",?40,"   ADMIN.",?70,"  BALANCE"
 W !,"DMC DATA:",?10,DMCBD(1),?20,$J(DMCBD(2),9,2),?30,$J(DMCBD(3),9,2),?40,$J(DMCBD(4),9,2),?70,$J(DMCAMT,9,2),!
 W !,?20,"PRINCIPLE",?30," INTEREST",?40,"   ADMIN.",?50," MARSHALL",?60,"     COURT",?70,"  BALANCE"
 I $D(^PRCA(430,BILL,7))'=0 D
 . W !,"ORIGINAL AMOUNT: ",?20,$J($P(^PRCA(430,BILL,0),"^",3),9,2)
 . D CALCCBAL^A4AARPT
 . W !!,?5,"CURRENT",?20,$J(PB,9,2),?30,$J(IB,9,2),?40,$J(AB,9,2),?50,$J(MF,9,2),?60,$J(CC,10,2),?70,$J(BAL,9,2)
 . D CALCPAY^A4AARPT
 . W !,?5,"PAID",?20,$J(PB,9,2),?30,$J(IB,9,2),?40,$J(AB,9,2),?50,$J(MF,9,2),?60,$J(CC,10,2),?70,$J(BAL,9,2)
 . W !,?20,LINE
 . D CALCOUT^A4AARPT
 . W !,?5,"OUTSTANDING",?20,$J(PB,9,2),?30,$J(IB,9,2),?40,$J(AB,9,2),?50,$J(MF,9,2),?60,$J(CC,10,2),?70,$J(BAL,9,2)
 . W !!,"EXCESS PAYMENT: ",$J($P(^PRCA(430,BILL,7),U,17),9,1),?30,"REFUNDED AMOUNT",?50,$J($P(^(7),U,18),9,2)," REFUNDED DATE: ",$P($P(^(7),U,19),".")
 E  W !,$J($P(^PRCA(430,BILL,0),"^",3),9,2)
 QUIT
