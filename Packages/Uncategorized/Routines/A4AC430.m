A4AC430 ;ISC4/JJM - PROGRAM TO CHECK FILE 430 ; 1/14/98 23:10
 ;;0.0;**** CLASS III ****;;JUNE 16, 1995
HSK S ERRCNT=0,U="^"
 S CNT=0,PROMPT=0
 S BN=0
START ;
 W !,?30,"   REPORT 8"
 W !,?30,"AUDIT FILE 430"
 D NOW^%DTC
 W !,"JOB STARTED: ",%
 W !,^PRCA(430,0)
 F  S BN=$O(^PRCA(430,BN)) Q:'BN  S CNT=CNT+1 W:(CNT#1000)=0 "." D  Q:PROMPT=1
 .  S AR430N0=$G(^PRCA(430,BN,0))
 .  S ARBILL=$P(AR430N0,"^",1)
 .  S ARCAT=$P(AR430N0,"^",2)
 .  S ARPAT=$P(AR430N0,"^",7)
 .  S ARCS=$P(AR430N0,"^",8)
 .  Q:(ARCS="49")!(ARCS="48")
 .  S ARDEB=$P(AR430N0,"^",9)
 .  D:ARBILL="" NOBILL
 .  IF ((ARPAT="")&(ARDEB=""))&("26,27,39,40,48,49"'[ARCS) D
 .. S ERRCNT=ERRCNT+1
 ..  W !,$J(ERRCNT,8),"  ****",$J(BN,8)," NO DEBTOR WITH CURRENT STATUS: ",ARCS,"  ****","(",$J(CNT,8)," )"
 .. W !,?10,"^PRCA(430,",BN,",0) ",AR430N0
 .  D:ARPAT'="" CHKPAT
 .  IF ARDEB="" D CHKF399 Q
 .  IF ('+$P($G(^RCD(340,ARDEB,0)),"^",1)) D
 ..  S ERRCNT=ERRCNT+1
 ..  W !,$J(ERRCNT,8),?10,"NAME NOT IN DEBTOR FILE (",CNT,")"
 ..  QUIT
EOJ ;
 D NOW^%DTC
 W !,"EOJ- ",CNT,"  ",%
 K AR430N0,ARBILL,ARDEB,ARPAT,BN,CNT,ERRCNT,PROMPT,ARCAT,ARCS,DGCR399,DIC
 K IB350,IBIEN,PFLAG,Y,%
 QUIT
CHKPAT IF ($P($G(^DPT(+ARPAT,0)),"^",1))="" D  Q
 .  S ERRCNT=ERRCNT+1
 .  W !,$J(ERRCNT,8),?8,"**** ",BN," PATIENT ",ARPAT," NOT IN PATIENT FILE **** (",CNT,")"
 IF ($P($G(^DPT(ARPAT,0)),"^",1))="" D BADPOINT
 QUIT
NOBILL S ERRCNT=ERRCNT+1
 W !,$J(ERRCNT,8),?8,"**** ",BN," NO BILL NUMBER **** (",CNT,")"
 QUIT
BADPOINT S ERRCNT=ERRCNT+1
 W !,$J(ERRCNT,8),?8,"**** ",BN,"  ",ARPAT," BAD POINTER **** (",CNT,")"
 W !,?10,"^PRCA(430,",BN,",0) ",AR430N0
 QUIT
CHKF399 ;
 Q:(ARBILL="")!(ARCS=26)
 S DGCR399=$D(^DGCR(399,"B",$P(ARBILL,"-",2)))
 Q:(DGCR399=10)&($D(^DGCR(399,BN))'=0)
CHKF350 ;
 S IB350=$D(^IB("ABIL",ARBILL))
 S IBIEN=$O(^IB("ABIL",ARBILL,""))
 I IBIEN="" D  QUIT
 . Q:("26,27,39,40,48,49,"'[ARCS)
 . S ERRCNT=ERRCNT+1
 . W !,$J(ERRCNT,8),?10,"BILL ",ARBILL,"  NOT IN FILES 350 & 399 (",CNT,")"
 .  IF ((ARCAT="")&(ARDEB="")) D
 .. S ERRCNT=ERRCNT+1
 ..  W !,$J(ERRCNT,8),"  ****",$J(BN,8)," NO DEBTOR OR CATEGORY: ",ARCAT,"  ****","(",$J(CNT,8)," )"
 . W !,?10,"^PRCA(430,",BN,",0) ",AR430N0,"(",IB350,"-",DGCR399,")"
 . QUIT
 Q:(IB350=10)&($D(^IB(IBIEN,0))>0)
 I IB350=10 D
 . S ERRCNT=ERRCNT+1
 . W !,$J(ERRCNT,8),?10,"BAD X-REFERENCE IN FILE 350 - ",ARBILL," (",CNT,")"
 I DGCR399=10 D
 . S ERRCNT=ERRCNT+1
 . W !,$J(ERRCNT,8),?10,"BAD X-REFERENCE IN FILE 399 - ",ARBILL,"(",CNT,")"
 QUIT
RESTART S CNT=258737
 S ERRCNT=399
 S BN=259714
 D START
 QUIT
PROMPT ;
 S ERRCNT=0
 S CNT=0
 S BN=""
 F  D  Q:('Y)!('$D(BN))
 . D EN1
 . Q:'Y
 . S PROMPT=1
 . D START
 . K PROMPT
 QUIT
EN1 ;
 S PFLAG=0
 S DIC="^PRCA(430,",DIC(0)="AEMNQZ" D ^DIC
 Q:Y=-1
 S BN=+Y
 W !,^PRCA(430,BN,0)
 S U="^"
 S BN=BN-1
 QUIT
EXIT ;;
 QUIT
