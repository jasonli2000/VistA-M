ADXTMP ;523/RES ; PATIENT FILE MOVE TO ^TMP("ADXT","PAT")   ;AUG 20, 1992
 ;;1.1;;
 ;
 K ^TMP("ADXT","PAT")
 N X,ADXTX1,ADXTREC,ADXTFL,ADXTR2
 ;S ADXTMTCH="2ANP1""/""7ANP1""-""2N1""-""17AN1""/"".E"
 S U="^",X="PATFILE.T01",ADXTX2=1,ADXTFL=0,ADXTR2=""
 K DIC S DIC="^DIZ(8980,",DIC(0)="" D ^DIC I Y'>0 S ADXTSTAT=0 W !,"PATFILE.T01 NOT FOUND!" Q
 S REC=$P(Y,U,1)
 W !,"Copying Patient records to ^TMP from Kermit Holding file: "
 F ADXTX1=0:0 S ADXTX1=$O(^DIZ(8980,REC,2,ADXTX1)) Q:ADXTX1=""  S ADXTREC=^DIZ(8980,REC,2,ADXTX1,0) D MOVE
 W !,"Transfer complete ",(ADXTX2-1)/2," records moved."
 G EXIT
MOVE ;
 I $E(ADXTX2,$L(ADXTX2))="0" W "."
 S ADXTLL=$L(ADXTREC)
 I $E(ADXTREC,11)="-"&($E(ADXTREC,14)="-")&(ADXTLL>227) S ^TMP("ADXT","PAT",ADXTX2)=$E(ADXTREC,1,227),ADXTR2=$E(ADXTREC,228,ADXTLL),ADXTX2=ADXTX2+1 Q
 I $E(ADXTREC,11)="-"&($E(ADXTREC,14)="-")&(ADXTLL<228) S ^TMP("ADXT","PAT",ADXTX2)=ADXTREC,ADXTX3=ADXTX1,ADXTR2="",ADXTFL=1,ADXTL2=ADXTLL Q
 I $E(ADXTREC,11)'="-"!($E(ADXTREC,14)'="-")&(ADXTFL'=1) S ^TMP("ADXT","PAT",ADXTX2)=ADXTR2_ADXTREC,ADXTR2="",ADXTX2=ADXTX2+1 Q
 I $E(ADXTREC,11)'="-"!($E(ADXTREC,14)'="-")&(ADXTFL=1)&(ADXTX1=ADXTX3+1) D MOVE2 S ADXTX2=ADXTX2+2,(ADXTL2,ADXTL3,ADXTFL,ADXTX3)=0 Q
 ;W !,"DISCARDING: ",ADXTX1,ADXTREC Q
MOVE2 ;
 S ADXTL3=(227-ADXTL2)
 S ^TMP("ADXT","PAT",ADXTX2)=^TMP("ADXT","PAT",ADXTX2)_$E(ADXTREC,1,ADXTL3)
 S ^TMP("ADXT","PAT",ADXTX2+1)=$E(ADXTREC,ADXTL3+1,ADXTLL) Q
EXIT ;
 K X,ADXTREC,ADXTMTCH,ADXTR2,ADXTLL,ADXTL2,ADXTL3,ADXTFL,ADXTRC1,ADXTX2,ADXTX3
 Q
