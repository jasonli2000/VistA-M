ASFSHOTF ;PROGRAM TO LIST OUT SHOT HISTORY FILE INFORMATION ON PHARMACY PROFILES ;7/12/93  13:00
 ;;V1.0 GDM/SYR 1/93
PRT ;I '$D(^DIZ(670210,"B",DFN)) W !?24,"** No Immunization Information **" Q
 W !?10,"** FOR IMMUNIZATION HISTORY USE HEALTH SUMMARY **"
 ;S DATA1=$O(^DIZ(670210,"B",DFN,"")) S PNEUM="No Data" D GETP 
 ;S (FL,TET,PPD,PPDR)="No  Data"
 ;D:$D(^DIZ(670210,DATA1,2,0)) GETF
 ;D:$D(^DIZ(670210,DATA1,3,0)) GETT
 ;D:$D(^DIZ(670210,DATA1,4,0)) GETPPD
 ;W !,?29,"* Last Immunizations *",!,"Last Pneumo: ",PNEUM,?29,"Last Flu: ",FL,?55,"Last Td: ",TET,!?3,"Last PPD: ",PPD,?27,"PPD Result: ",PPDR
 ;K DATA1,PNEUM,TET,FL,PPD,PPDR
 Q
GETP ;CODE TO GET LAST PNEUMOVAX
 Q:'$O(^DIZ(670210,DATA1,1,0))  S PDATE="" F I=0:0 S PDATE=$O(^DIZ(670210,DATA1,1,"B",PDATE)) Q:PDATE=""  S RECNO=$O(^DIZ(670210,DATA1,1,"B",PDATE,""))
 S Y=$P(^DIZ(670210,DATA1,1,RECNO,0),"^",1) X ^DD("DD") S PNEUM=Y K Y,PDATE,RECNO
 Q
GETF ;CODE TO GET LAST FLU SHOT
 Q:'$O(^DIZ(670210,DATA1,2,0))  S FDATE="" F I=0:0 S FDATE=$O(^DIZ(670210,DATA1,2,"B",FDATE)) Q:FDATE=""  S RECNO=$O(^DIZ(670210,DATA1,2,"B",FDATE,""))
 S Y=$P(^DIZ(670210,DATA1,2,RECNO,0),"^",1) X ^DD("DD") S FL=Y K Y,FDATE,RECNO
 Q
GETT ;CODE TO GET LAST TETANOUS SHOT
 Q:'$O(^DIZ(670210,DATA1,3,0))  S TDATE="" F I=0:0 S TDATE=$O(^DIZ(670210,DATA1,3,"B",TDATE)) Q:TDATE=""  S RECNO=$O(^DIZ(670210,DATA1,3,"B",TDATE,""))
 S Y=$P(^DIZ(670210,DATA1,3,RECNO,0),"^",1) X ^DD("DD") S TET=Y K Y,TDATE,RECNO
 Q
GETPPD ;CODE TO GET PPD DATA
 Q:'$O(^DIZ(670210,DATA1,4,0))  S PPDATE="" F I=0:0 S PPDATE=$O(^DIZ(670210,DATA1,4,"B",PPDATE)) Q:PPDATE=""  S RECNO=$O(^DIZ(670210,DATA1,4,"B",PPDATE,""))
 S PPDATA=^DIZ(670210,DATA1,4,RECNO,0),Y=$P(PPDATA,"^",1) X ^DD("DD") S PPD=Y K Y
 S PPDR=$P(PPDATA,"^",2),PPDR=$S(PPDR=1:"Negative",PPDR=2:"Positive",1:"not Entered")
 K RECNO,PPDATE
 Q
