RJPTF40X ;RJ WILM DE -MAKE 40X PTF CARD; 12-12-85
 ;;4.0
 K Z S (Z1,K)=0 F K=1:1 S Z1=$O(^DGPT(I,"S",Z1)) Q:Z1=""!(Z1'?.N)  S RJN401="N401("_K_")" D N40X
 I $D(^DGPT(I,"401P")) D P S Y=@RJN401,X=80 D LJ S @RJN401=Y
 K K,L,RJN401,RJPTF,Z,Y,X,D,J,Z1,Z2,XX Q
N40X S RJPTF=^DGPT(I,"S",Z1,0) I $P(RJPTF,"^",2)="P" S @RJN401="N401"_RJCON_"P           " D CODE S Y=@RJN401,X=80 D LJ S @RJN401=Y Q
 E  D S
 D CODE I '$D(Z(Z)) S Z(Z)="",XX="N401"
 E  S XX="N402"
 S @RJN401=XX_RJCON_@RJN401,Y=@RJN401,X=80 D LJ S @RJN401=Y
 Q
CODE S X=6 F Z2=8:1:12 S Y=$P(RJPTF,"^",Z2) D OP,D,LJ S @RJN401=@RJN401_Y
 Q
S S Z=$P(RJPTF,"^",1),X=$S($P(RJPTF,"^",7)'="":$P(RJPTF,"^",7),1:" "),@RJN401=$E(Z,4,7)_$E(Z,2,3)_$P(^DIC(45.3,$P(RJPTF,"^",3),0),"^",1)_$P(RJPTF,"^",4)_$P(RJPTF,"^",5)_$P(RJPTF,"^",6)_X Q
P S X=6,RJN401="N401("_K_")",@RJN401="N401"_RJCON_"P           "
 F L=1:1:5 S Y=$P(^DGPT(I,"401P"),"^",L) Q:Y=""  S Y=$P(^ICD0(Y,0),"^",1) D D,LJ S @RJN401=@RJN401_Y
 Q
LJ F J=$L(Y):1:X S Y=Y_" "
 Q
D Q:Y'["."  S J="" F D=1:1:$L(Y) S:$E(Y,D)'="." J=J_$E(Y,D)
 S Y=J Q
OP Q:Y=""  S Y=$P(^ICD0(Y,0),"^",1) Q
