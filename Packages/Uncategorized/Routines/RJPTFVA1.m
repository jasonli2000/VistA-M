RJPTFVA1 ;RJ WILM DE -CONTROLS CREATING PTF CODE SHEETS; 12-12-85
 ;;4.0
 D ^RJPTFXM Q:DUZ<.5  S:'$D(^DGPT("PU")) ^DGPT("PU")=0 S:'$D(DTIME) DTIME=300 S RJ(2)="",RJ(1)=0
 F RJPTFA=1:1 S I=$P(A,",",RJPTFA) G:I="" E D X
X D KILL I '$D(^DGP(45.84,I,0)) W !,"PTF NUMBER ",I," HAS NOT BEEN CHECKED." Q
 I $P(^(0),"^",2)="" W !,"PTF NUMBER ",I," HAS NOT BEEN RUN THROUGH THE DRG CALCULATOR." Q
 W !,"PTF NUMBER ",I," being coded." D KILL,L S:$P(^DGP(45.84,I,0),"^",4)="" ^DGP(45.84,I,0)=$P(^(0),"^",1,3)_"^"_DT_"^"_DUZ S ^DGP(45.84,"AC",I,I)="" S $P(^DGPT(I,0),"^",6)=3
 Q
E I RJERL'="" W !,"PATIENTS CARDS COULD NOT BE PUNCHED, MISSING DATA!",! F I=1:1:79 W "="
 F I=2:1 Q:$P(RJERL,U,I)=""  W !,$P(RJERL,U,I),"  ",$P(^DPT($P(^DGPT($P(RJERL,U,I),0),U,1),0),U,1)
 W !,"There was a total of ",RJ(1)," cards coded." S ^DGPT("PU")=^DGPT("PU")+RJ(1),^XMB(3.9,RJXM,2,0)="^^"_RJ(1)_"^"_RJ(1)_"^"_DT_"^^"
 D KILL K RJ,J,M,RJXM Q
L I RJERL'[(U_I) D ^RJPTFCOD,^RJPTF101 S L=RJN101 D PUNCH,^RJPTF701 S L=RJN701 D PUNCH S:$D(RJN702) L=RJN702 D:$D(RJN702) PUNCH
 I RJERL'[(U_I) S:$D(RJN703) L=RJN703 D:$D(RJN703) PUNCH D ^RJPTF50X S J="N501(" D S,^RJPTF40X S J="N401(" D S
 Q
S F M=1:1 S L=J_M S:L["N501"!(L["N401") L=L_")" Q:'$D(@L)  S L=@L D PUNCH D:L["N501" S1 D:L["N40" S2
 Q
S1 S L="N502("_M_")" I $D(@L) S L=@L D PUNCH
 S L="N503("_M_")" I $D(@L) S L=@L D PUNCH
 Q
S2 S L="N403("_M_")" I $D(@L) S L=@L D PUNCH
 S L="N402("_M_")" I $D(@L) S L=@L D PUNCH
 S L="N404("_M_")" I $D(@L) S L=@L D PUNCH
 Q
PUNCH S RJ(1)=RJ(1)+1,^XMB(3.9,RJXM,2,RJ(1),0)=$E(L,1,80) Q
KILL K N401,N402,N403,N404,N501,N502,N503,RJN101,RJN701,RJN702,RJN703,RJCON,RJPAT Q
