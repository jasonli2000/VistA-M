ZPCUTL2 ;CONTINUATION OF CURRENT HOST DATA ;2/28/95  16:39
 ;COPYRIGHT VETERANS RESEARCH FOUNDATION OF PITTSBURGH 1995
 ;COPYRIGHT ASPIRE TECHNOLOGIES 1995
DEMOG ;GET PATIENT DEMOGRAPHICS
 N ADDR,ADDR2,CITY,STDFN,ZIP,DFN,SSN,SSNX,TELEP
 S DFN=$P(X,"|",3)
 S Y=$G(^DPT(DFN,.11))
 I DFN="" W "**Unknown patient",! Q
 S ADDR=$P(Y,"^",1),ADDR2=$P(Y,"^",2),CITY=$P(Y,"^",4),STDFN=$P(Y,"^",5)
 S ZIP=$P(Y,"^",6)
 S TELEP=$G(^DPT(DFN,.13)),HOMEPH=$P(TELEP,"^",1),WORKPH=$P(TELEP,"^",2)
 S SSNX=$G(^DPT(DFN,0)),SSN=$P(SSNX,"^",9)
 I STDFN'="" S STATE=$P(^DIC(5,STDFN,0),"^",2)
 W "|"_SSN_"|"_ADDR_"|"_ADDR2_"|"_CITY_"|"_STATE_"|"_ZIP_"|"_HOMEPH_"|"_WORKPH,!
 Q
MAIL ;
 S MESSNUM=$P(X,"|",3)
 S I="" F  S I=$O(^XMB(3.9,MESSNUM,2,I)) Q:I=""  D  ;
 .S XX=$G(^XMB(3.9,MESSNUM,2,I,0))
 .W XX,!
 Q
MAILBOX ;
 ;
 S DUZ=1
 S BASKNUM="" F  S BASKNUM=$O(^XMB(3.7,DUZ,2,BASKNUM)) Q:BASKNUM=""  D LISTBAS
 Q
LISTBAS ;
 S XX=$G(^XMB(3.7,DUZ,2,BASKNUM,0))
 S YY=$P(XX,"^",1)
 W YY,!
 Q
BOXMESS ;
 S DUZ=1,BASK=1
 S MESSNUM="" F  S MESSNUM=$O(^XMB(3.7,DUZ,2,BASK,1,MESSNUM)) Q:MESSNUM=""!(MESSNUM="C")  D LISTM
 Q
LISTM ;
 W MESSNUM,!
 Q
MAILOUT ;MAIL GOING OUT
 ;NEED MSGNUM
 N J,MAILG
 S MAILG="^XMB(3.9,"_MSGNO_",2,"
 S J=0 F  S @("J=$O("_MAILG_"J))") Q:J'>0  W !,^(J,0)
 Q
 ;N X
FMWPOUT ;TRANSMIT FM  WP FIELD TO PC
 N J
 I $D(DIC)=0 W "**ERROR no FM file defined.",! Q
 S J=0 F  S @("J=$O("_DIC_"J))") Q:J'>0  W !,^(J,0)
 Q
 ZVBUTL2
