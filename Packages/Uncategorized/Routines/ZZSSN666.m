ZZSSN666 ; Routine to change test account SSNs to start with 666
 
CKALL N LASTSIX,FIRST3,IEN,NEWSSN
 S COUNT=0,SIX=666,COUNT2=0
 ;S I=0
 S IEN=0
 F  S IEN=$O(^DPT(IEN)) Q:'IEN  D
 .S SSNHOLD=$P($G(^DPT(IEN,0)),"^",9)
 .S LASTSIX=$E(SSNHOLD,4,9)
 .S LASTFOUR=$E(SSNHOLD,6,9)
 .I $L(LASTSIX)<6 S ERRSSN="BAD SSN" D BADSSN1  Q
 .S NEWSSN=SIX_LASTSIX
 .S DA=IEN,DIE="^DPT(",DR=".09///^S X=NEWSSN"
 .D ^DIE
 .I $D(Y(1)) S ERRSSN="POTENTIAL DUP" D BADSSN Q
 .S COUNT=COUNT+1
 W !,"TOTAL PATIENTS UPDATED:  ",COUNT
 W !,"TOTAL PATIENTS THAT COULD NOT BE UPDATED:  ",COUNT2
 Q
BADSSN S MID2=$R(99)
 I $L(MID2)<2 S MID2="9"_MID2
 S NEWSSN=SIX_MID2_LASTFOUR
 S DA=IEN,DIE="^DPT(",DR=".09///^S X=NEWSSN" 
 D ^DIE
 I '$D(Y(1)) Q
 S ERRSSN="POTENTIAL DUP"   
BADSSN1 W !,ERRSSN,?20,$P($G(^DPT(IEN,0)),"^",1),"     SSN : ",SSNHOLD,"   IEN ",IEN
 S COUNT2=COUNT2+1
 Q        
